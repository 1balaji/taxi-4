-- 피드
DROP TABLE IF EXISTS `FEED` RESTRICT;
-- 방참여회원정보
DROP TABLE IF EXISTS `ROOM_MBR` RESTRICT;
-- 방정보
DROP TABLE IF EXISTS `ROOM` RESTRICT;
-- 경로위치정보
DROP TABLE IF EXISTS `PATH_LOC` RESTRICT;
-- 자주가는위치정보
DROP TABLE IF EXISTS `FVRT_LOC` RESTRICT;
-- 회원정보
DROP TABLE IF EXISTS `MBR` RESTRICT;


-- 회원정보
CREATE TABLE `MBR` (
	`MBR_EMAIL`     VARCHAR(40)  NOT NULL COMMENT '회원이메일', -- 회원이메일
	`MBR_NAME`      VARCHAR(50)  NOT NULL COMMENT '회원이름', -- 회원이름
	`MBR_PHONE_NO` VARCHAR(30)  NOT NULL COMMENT '회원핸드폰번호', -- 회원핸드폰번호
	`MBR_PHOTO`     VARCHAR(255) NOT NULL COMMENT '회원사진', -- 회원사진
	`MBR_GENDER`    VARCHAR(10)  NULL     COMMENT '성별', -- 성별
	`MBR_REG_DATE`  DATETIME     NOT NULL COMMENT '회원가입일시' -- 회원가입일시
)
COMMENT '회원정보';

-- 회원정보
ALTER TABLE `MBR`
	ADD CONSTRAINT `PK_MBR` -- 회원정보 기본키
		PRIMARY KEY (
			`MBR_EMAIL` -- 회원이메일
		);

-- 방참여회원정보
CREATE TABLE `ROOM_MBR` (
	`ROOM_NO`      INTEGER     NOT NULL COMMENT '방번호', -- 방번호
	`MBR_EMAIL`    VARCHAR(40) NOT NULL COMMENT '회원이메일', -- 회원이메일
	`FRND_EMAIL`   VARCHAR(40) NULL     COMMENT '페이스북 친구 이메일', -- 친구이메일
	`FRND_2_EMAIL` VARCHAR(40) NULL     COMMENT '페이스북 친구의 친구 이메일' -- 친구의친구이메일
)
COMMENT '방참여회원정보';

-- 방참여회원정보
ALTER TABLE `ROOM_MBR`
	ADD CONSTRAINT `PK_ROOM_MBR` -- 방참여회원정보 기본키
		PRIMARY KEY (
			`ROOM_NO`,   -- 방번호
			`MBR_EMAIL`  -- 회원이메일
		);

-- 방정보
CREATE TABLE `ROOM` (
	`ROOM_NO`           INTEGER  NOT NULL COMMENT '방번호', -- 방번호
	`ROOM_START_TIME`   DATETIME NOT NULL COMMENT '출발시간', -- 출발시간
	`START_PATH_LOC_NO` INTEGER  NOT NULL COMMENT '출발지위치번호', -- 출발지위치번호
	`END_PATH_LOC_NO`   INTEGER  NOT NULL COMMENT '목적지위치번호', -- 목적지위치번호
	`ROOM_DISTANCE`     INTEGER  NOT NULL COMMENT '거리', -- 거리
	`ROOM_FARE`         INTEGER  NOT NULL COMMENT '요금', -- 요금
	`ROOM_REG_DATE`     DATETIME NOT NULL COMMENT '방등록일시' -- 방등록일시
)
COMMENT '방정보';

-- 방정보
ALTER TABLE `ROOM`
	ADD CONSTRAINT `PK_ROOM` -- 방정보 기본키
		PRIMARY KEY (
			`ROOM_NO` -- 방번호
		);

ALTER TABLE `ROOM`
	MODIFY COLUMN `ROOM_NO` INTEGER NOT NULL AUTO_INCREMENT COMMENT '방번호';

-- 피드
CREATE TABLE `FEED` (
	`FEED_NO`           INTEGER      NOT NULL COMMENT '피드번호', -- 피드번호
	`FEED_CONTENT`      VARCHAR(255) NOT NULL COMMENT '피드내용', -- 피드내용
	`FEED_WRITER_EMAIL` VARCHAR(40)  NOT NULL COMMENT '피드작성자이메일', -- 피드작성자이메일
	`FEED_REG_DATE`     DATETIME     NOT NULL COMMENT '피드등록일시', -- 피드등록일시
	`ROOM_NO`           INTEGER      NOT NULL COMMENT '방번호' -- 방번호
)
COMMENT '피드';

-- 피드
ALTER TABLE `FEED`
	ADD CONSTRAINT `PK_FEED` -- 피드 기본키
		PRIMARY KEY (
			`FEED_NO` -- 피드번호
		);

ALTER TABLE `FEED`
	MODIFY COLUMN `FEED_NO` INTEGER NOT NULL AUTO_INCREMENT COMMENT '피드번호';

-- 자주가는위치정보
CREATE TABLE `FVRT_LOC` (
	`FVRT_LOC_NO`       INTEGER      NOT NULL COMMENT '자주가는위치번호', -- 자주가는위치번호
	`MBR_EMAIL`         VARCHAR(40)  NOT NULL COMMENT '회원이메일', -- 회원이메일
	`FVRT_LOC_NAME`     VARCHAR(255) NOT NULL COMMENT '자주가는위치명', -- 자주가는위치명
	`FVRT_LOC_LAT`      VARCHAR(50)  NOT NULL COMMENT '위도', -- 위도
	`FVRT_LOC_LNG`      VARCHAR(50)  NOT NULL COMMENT '경도', -- 경도
	`FVRT_LOC_REG_DATE` DATETIME     NULL     COMMENT '자주가는위치등록일시', -- 자주가는위치등록일시
	`FVRT_LOC_RANK`     INTEGER      NULL     COMMENT '자주가는위치우선순위', -- 자주가는위치우선순위
	`FVRT_LOC_STATUS`   VARCHAR(5)   NOT NULL COMMENT '즐겨찾기 최근목적지 구분' -- 자주가는위치구분
)
COMMENT '자주가는위치정보';

-- 자주가는위치정보
ALTER TABLE `FVRT_LOC`
	ADD CONSTRAINT `PK_FVRT_LOC` -- 자주가는위치정보 기본키
		PRIMARY KEY (
			`FVRT_LOC_NO` -- 자주가는위치번호
		);

ALTER TABLE `FVRT_LOC`
	MODIFY COLUMN `FVRT_LOC_NO` INTEGER NOT NULL AUTO_INCREMENT COMMENT '자주가는위치번호';

-- 경로위치정보
CREATE TABLE `PATH_LOC` (
	`PATH_LOC_NO`           INTEGER      NOT NULL COMMENT '경로위치번호', -- 경로위치번호
	`PATH_LOC_NAME`         VARCHAR(255) NOT NULL COMMENT '경로위치명', -- 경로위치명
	`PATH_LOC_LAT`          VARCHAR(50)  NOT NULL COMMENT '위도', -- 위도
	`PATH_LOC_LNG`          VARCHAR(50)  NOT NULL COMMENT '경도', -- 경도
	`PATH_LOC_SEARCH_RANGE` INTEGER      NOT NULL COMMENT '검색반경', -- 검색반경
	`PATH_LOC_STATUS`       VARCHAR(5)   NOT NULL COMMENT '출발지 목적지 구분' -- 경로위치구분
)
COMMENT '경로위치정보';

-- 경로위치정보
ALTER TABLE `PATH_LOC`
	ADD CONSTRAINT `PK_PATH_LOC` -- 경로위치정보 기본키
		PRIMARY KEY (
			`PATH_LOC_NO` -- 경로위치번호
		);

ALTER TABLE `PATH_LOC`
	MODIFY COLUMN `PATH_LOC_NO` INTEGER NOT NULL AUTO_INCREMENT COMMENT '경로위치번호';

-- 방참여회원정보
ALTER TABLE `ROOM_MBR`
	ADD CONSTRAINT `FK_ROOM_TO_ROOM_MBR` -- 방정보 -> 방참여회원정보
		FOREIGN KEY (
			`ROOM_NO` -- 방번호
		)
		REFERENCES `ROOM` ( -- 방정보
			`ROOM_NO` -- 방번호
		);

-- 방참여회원정보
ALTER TABLE `ROOM_MBR`
	ADD CONSTRAINT `FK_MBR_TO_ROOM_MBR` -- 회원정보 -> 방참여회원정보
		FOREIGN KEY (
			`MBR_EMAIL` -- 회원이메일
		)
		REFERENCES `MBR` ( -- 회원정보
			`MBR_EMAIL` -- 회원이메일
		);

-- 방정보
ALTER TABLE `ROOM`
	ADD CONSTRAINT `FK_PATH_LOC_TO_ROOM` -- 경로위치정보 -> 방정보
		FOREIGN KEY (
			`START_PATH_LOC_NO` -- 출발지위치번호
		)
		REFERENCES `PATH_LOC` ( -- 경로위치정보
			`PATH_LOC_NO` -- 경로위치번호
		);

-- 방정보
ALTER TABLE `ROOM`
	ADD CONSTRAINT `FK_PATH_LOC_TO_ROOM2` -- 경로위치정보 -> 방정보2
		FOREIGN KEY (
			`END_PATH_LOC_NO` -- 목적지위치번호
		)
		REFERENCES `PATH_LOC` ( -- 경로위치정보
			`PATH_LOC_NO` -- 경로위치번호
		);

-- 피드
ALTER TABLE `FEED`
	ADD CONSTRAINT `FK_ROOM_MBR_TO_FEED` -- 방참여회원정보 -> 피드
		FOREIGN KEY (
			`ROOM_NO`,           -- 방번호
			`FEED_WRITER_EMAIL`  -- 피드작성자이메일
		)
		REFERENCES `ROOM_MBR` ( -- 방참여회원정보
			`ROOM_NO`,   -- 방번호
			`MBR_EMAIL`  -- 회원이메일
		);

-- 자주가는위치정보
ALTER TABLE `FVRT_LOC`
	ADD CONSTRAINT `FK_MBR_TO_FVRT_LOC` -- 회원정보 -> 자주가는위치정보
		FOREIGN KEY (
			`MBR_EMAIL` -- 회원이메일
		)
		REFERENCES `MBR` ( -- 회원정보
			`MBR_EMAIL` -- 회원이메일
		);







-- 테스트 데이터
